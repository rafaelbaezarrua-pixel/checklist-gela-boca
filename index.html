<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checklist - Gela Boca</title>
    
    <!-- Fontes Online do Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Shrikhand&family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* Removemos as fontes locais e usamos apenas as online */
        :root {
            /* Cores institucionais Gela Boca */
            --magenta: #ED297C;
            --rosa-claro: #FF89C2;
            --azul-claro: #BCE4FA;
            --amarelo: #F2E61A;
            --magenta-escuro: #B10061;
            --azul: #76C8DA;
            --branco: #FFFFFF;
            --preto: #000000;
            --cinza: #6c757d;
            --cinza-claro: #f8f9fa;
            --sombra: 0 4px 12px rgba(0, 0, 0, 0.1);
            --raio: 12px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            /* Aplicando Nunito como fonte padrão para todo o sistema */
            font-family: 'Nunito', 'Arial Narrow', Arial, sans-serif;
            font-weight: normal;
        }

        body {
            /* Plano de fundo padrão para desktop */
            background-image: url('images/Wallpaper2.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
            min-height: 100vh;
            padding: 20px;
            color: var(--preto);
            line-height: 1.6;
            /* Garantindo que o body também use Nunito */
            font-family: 'Nunito', 'Arial Narrow', Arial, sans-serif;
        }

        /* Para dispositivos móveis - max-width: 768px */
        @media (max-width: 768px) {
            body {
                background-image: url('images/wallpaper1.png');
                background-size: cover;
                background-position: center;
                background-repeat: no-repeat;
                background-attachment: fixed;
            }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .card {
            background: var(--branco);
            border-radius: var(--raio);
            box-shadow: var(--sombra);
            padding: 25px;
            margin-bottom: 25px;
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        /* Tipografia - Títulos com Shrikhand, textos com Nunito */
        h1, h2, h3 {
            font-family: 'Shrikhand', cursive;
            color: var(--magenta);
            margin-bottom: 20px;
        }

        h1 {
            font-size: 2.2rem;
            text-align: center;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        h2 {
            font-size: 1.8rem;
        }

        h3 {
            font-size: 1.5rem;
        }

        /* Aplicando Nunito em todos os textos */
        p, li, label, input, select, button, .btn, .checklist-title, .header-title, .user-info, .checklist-item label, .progress-text, .modal-content, .footer {
            font-family: 'Nunito', 'Arial Narrow', Arial, sans-serif;
        }

        p, li, label {
            font-size: 1rem;
            margin-bottom: 1rem;
        }

        .screen {
            display: none;
        }

        .active {
            display: block;
        }

        /* Login Screen */
        .login-container {
            max-width: 450px;
            margin: 60px auto;
            padding: 40px;
            background: var(--branco);
            border-radius: var(--raio);
            box-shadow: var(--sombra);
            text-align: center;
            backdrop-filter: blur(5px);
            background: rgba(255, 255, 255, 0.95);
        }

        .logo {
            max-width: 300px;
            margin: 0 auto 20px auto;
        }

        .logo img {
            width: 100%;
            height: auto;
        }

        .checklist-title {
            font-size: 2rem;
            color: var(--magenta);
            margin-bottom: 30px;
            font-weight: 600;
            text-align: center;
            font-family: 'Nunito', 'Arial Narrow', Arial, sans-serif;
        }

        .input-group {
            margin-bottom: 20px;
            text-align: left;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--magenta-escuro);
            font-family: 'Nunito', 'Arial Narrow', Arial, sans-serif;
        }

        input, select {
            width: 100%;
            padding: 14px;
            border: 2px solid var(--azul-claro);
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
            font-family: 'Nunito', 'Arial Narrow', Arial, sans-serif;
            font-weight: normal;
        }

        input:focus, select:focus {
            border-color: var(--magenta);
            outline: none;
        }

        .btn {
            display: inline-block;
            padding: 14px 28px;
            background: var(--magenta);
            color: var(--branco);
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            font-family: 'Nunito', 'Arial Narrow', Arial, sans-serif;
        }

        .btn:hover {
            background: var(--magenta-escuro);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: var(--amarelo);
            color: var(--preto);
        }

        .btn-secondary:hover {
            background: #e6c200;
        }

        .btn-danger {
            background: var(--magenta-escuro);
        }

        .btn-danger:hover {
            background: #90004d;
        }

        .btn-success {
            background: var(--azul);
            color: var(--preto);
        }

        .btn-success:hover {
            background: #5cb3c5;
        }

        .btn-warning {
            background: #ffc107;
            color: var(--preto);
        }

        .btn-warning:hover {
            background: #e0a800;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 0.9rem;
        }

        .btn-link {
            background: none;
            color: var(--magenta);
            text-decoration: underline;
            padding: 5px 10px;
            font-family: 'Nunito', 'Arial Narrow', Arial, sans-serif;
        }

        .btn-link:hover {
            background: none;
            transform: none;
            color: var(--magenta-escuro);
        }

        .login-options {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--azul-claro);
        }

        .header-logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header-logo img {
            height: 50px;
            width: auto;
        }

        .header-title {
            font-family: 'Nunito', 'Arial Narrow', Arial, sans-serif;
            font-size: 1.8rem;
            font-weight: 600;
            color: var(--magenta);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
            font-family: 'Nunito', 'Arial Narrow', Arial, sans-serif;
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--magenta);
            color: var(--branco);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
        }

        /* Checklist Selector - ATUALIZADO SEM ÍCONES */
        .checklist-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .checklist-option {
            background: var(--branco);
            border: 2px solid var(--azul-claro);
            border-radius: var(--raio);
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .checklist-option:hover {
            border-color: var(--magenta);
            transform: translateY(-5px);
        }

        .checklist-option.selected {
            border-color: var(--magenta);
            background: var(--magenta);
            color: var(--branco);
        }

        /* Checklist Items */
        .checklist-section {
            margin-bottom: 30px;
        }

        .checklist-item {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            padding: 15px;
            margin-bottom: 10px;
            background: var(--cinza-claro);
            border-radius: 8px;
            transition: background 0.3s;
        }

        .checklist-item:hover {
            background: #f0f0f0;
        }

        .checklist-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-top: 3px;
            cursor: pointer;
            accent-color: var(--magenta);
        }

        .checklist-item label {
            flex: 1;
            margin: 0;
            cursor: pointer;
            font-weight: normal;
            line-height: 1.5;
            font-family: 'Nunito', 'Arial Narrow', Arial, sans-serif;
        }

        .checklist-item.checked label {
            text-decoration: line-through;
            color: var(--cinza);
        }

        /* Progress Bar */
        .progress-container {
            margin: 20px 0;
        }

        .progress-bar {
            height: 12px;
            background: #ecf0f1;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress {
            height: 100%;
            background: linear-gradient(90deg, var(--azul), var(--magenta));
            border-radius: 10px;
            transition: width 0.5s ease;
            width: 0%;
        }

        .progress-text {
            text-align: center;
            font-weight: 600;
            color: var(--cinza);
            margin-top: 5px;
            font-family: 'Nunito', 'Arial Narrow', Arial, sans-serif;
        }

        /* Upload de Imagens */
        .image-upload-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 10px;
        }

        .image-preview {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .image-item {
            position: relative;
            width: 100px;
            height: 100px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .image-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .image-actions {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.7);
            display: flex;
            justify-content: space-around;
            padding: 5px;
        }

        .image-action-btn {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .image-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .image-modal-content {
            max-width: 90%;
            max-height: 90%;
        }

        .image-modal-content img {
            width: 100%;
            height: auto;
            border-radius: 8px;
        }

        .close-modal {
            position: absolute;
            top: 20px;
            right: 20px;
            color: white;
            font-size: 2rem;
            cursor: pointer;
        }

        /* User Management */
        .user-list {
            margin-top: 20px;
        }

        .user-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            background: var(--cinza-claro);
            border-radius: 8px;
            font-family: 'Nunito', 'Arial Narrow', Arial, sans-serif;
        }

        .user-actions {
            display: flex;
            gap: 10px;
        }

        /* Saved Dates */
        .saved-dates {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .date-card {
            background: var(--cinza-claro);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Nunito', 'Arial Narrow', Arial, sans-serif;
        }

        .date-card:hover {
            background: #f0f0f0;
            transform: translateY(-3px);
        }

        .date-card .date {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .date-card .checklist-type {
            font-size: 0.9rem;
            color: var(--cinza);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--branco);
            padding: 30px;
            border-radius: var(--raio);
            box-shadow: var(--sombra);
            max-width: 500px;
            width: 90%;
            font-family: 'Nunito', 'Arial Narrow', Arial, sans-serif;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--cinza);
        }

        /* Backup Section */
        .backup-section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid var(--azul-claro);
        }

        .backup-actions {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .backup-info {
            background: var(--cinza-claro);
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-size: 0.9rem;
        }

        .backup-info ul {
            margin-left: 20px;
            margin-top: 10px;
        }

        .backup-info li {
            margin-bottom: 5px;
        }

        /* Footer */
        .footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid var(--azul-claro);
            color: var(--cinza);
            font-size: 0.9rem;
            font-family: 'Nunito', 'Arial Narrow', Arial, sans-serif;
        }

        /* Responsive */
        @media (max-width: 768px) {
            body {
                background-image: url('images/wallpaper1.png');
            }

            .header {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }
            
            .header-logo {
                flex-direction: column;
                text-align: center;
            }
            
            .checklist-selector {
                grid-template-columns: 1fr;
            }
            
            .saved-dates {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }

            .login-options {
                flex-direction: column;
                align-items: center;
            }
            
            .image-item {
                width: 80px;
                height: 80px;
            }
            
            .logo {
                max-width: 250px;
            }

            .backup-actions {
                flex-direction: column;
            }

            .login-container {
                margin: 30px auto;
                padding: 25px;
            }
        }

        /* Estilo para a tela de checklist */
        #checklistScreen {
            background: var(--branco);
            border-radius: var(--raio);
            box-shadow: var(--sombra);
            padding: 30px;
            margin: 20px;
        }

        /* Divider para separar seções */
        .divider {
            height: 1px;
            background: linear-gradient(to right, transparent, var(--azul-claro), transparent);
            margin: 25px 0;
        }

        /* Ações do checklist */
        .checklist-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }

        /* Anexos de imagem */
        .image-attachments {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 20px;
        }

        .image-attachment {
            width: 120px;
            height: 120px;
            border: 2px dashed var(--azul-claro);
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--cinza);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .image-attachment:hover {
            border-color: var(--magenta);
            color: var(--magenta);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Login Screen -->
        <div id="loginScreen" class="screen active">
            <div class="login-container">
                <div class="checklist-title">Checklist</div>
                <div class="logo">
                    <!-- Logo atualizada com caminho correto -->
                    <img src="images/logo-gela-boca.png" alt="Gela Boca" onerror="this.style.display='none'; document.getElementById('fallbackLogo').style.display='block';">
                    <div id="fallbackLogo" style="display: none; font-family: 'Shrikhand', cursive; font-size: 3.5rem; color: var(--magenta); margin-bottom: 20px;">
                        gelaboca
                    </div>
                </div>
                <div class="checklist-title">Fazenda Rio Grande</div>
                
                <div class="input-group">
                    <label for="username">Usuário</label>
                    <input type="text" id="username" placeholder="Digite seu usuário">
                </div>
                
                <div class="input-group">
                    <label for="password">Senha</label>
                    <input type="password" id="password" placeholder="Digite sua senha">
                </div>
                
                <button id="loginBtn" class="btn" style="width: 100%;">Entrar</button>
                
                <div class="login-options">
                    <button id="createAccountBtn" class="btn-link">Criar Acesso</button>
                    <button id="forgotPasswordBtn" class="btn-link">Esqueci minha senha</button>
                </div>
                
                <p id="loginMsg" style="color: var(--magenta-escuro); margin-top: 15px;"></p>
            </div>
        </div>

        <!-- Home Screen -->
        <div id="homeScreen" class="screen">
            <div class="header">
                <div class="header-logo">
                    <!-- Logo no header com caminho correto -->
                    <img src="images/logo-gela-boca.png" alt="Gela Boca" onerror="this.style.display='none';">
                    <div class="header-title">Checklist</div>
                </div>
                <div class="user-info">
                    <div class="user-avatar" id="userAvatar">U</div>
                    <div>
                        <div id="userWelcome">Bem-vindo, Usuário</div>
                        <div style="display: flex; gap: 10px; margin-top: 5px;">
                            <button id="userManagementBtn" class="btn btn-secondary btn-small" style="display: none;">Gerenciar Usuários</button>
                            <button id="changePasswordBtn" class="btn btn-secondary btn-small">Alterar Senha</button>
                            <button id="logoutBtn" class="btn btn-danger btn-small">Sair</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SEÇÃO DE CHECKLISTS SEM ÍCONES -->
            <div class="card">
                <h2>Selecionar Checklist</h2>
                <div class="checklist-selector">
                    <div class="checklist-option selected" data-checklist="abertura">
                        <h3>Abertura de Loja</h3>
                        <p>Checklist completo para abertura</p>
                    </div>
                    
                    <div class="checklist-option" data-checklist="cozinha">
                        <h3>Cozinha</h3>
                        <p>Verificação da área de produção</p>
                    </div>
                    
                    <div class="checklist-option" data-checklist="cozinha-fechamento">
                        <h3>Cozinha (Fechamento)</h3>
                        <p>Preparação para o próximo dia</p>
                    </div>
                    
                    <div class="checklist-option" data-checklist="fechamento">
                        <h3>Fechamento</h3>
                        <p>Checklist completo para fechamento</p>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>Selecionar Data</h2>
                <div style="display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
                    <div class="input-group" style="flex: 1; min-width: 200px;">
                        <label for="selectedDate">Data do Checklist</label>
                        <input type="date" id="selectedDate">
                    </div>
                    <button id="openBtn" class="btn">Abrir Checklist</button>
                    <button id="todayBtn" class="btn btn-secondary">Usar Hoje</button>
                </div>
                <p style="margin-top: 15px; color: var(--cinza); font-size: 0.9rem;">
                    Ao abrir uma data, o checklist será gerado. As marcações são salvas automaticamente.
                </p>
            </div>

            <div class="card">
                <h2>Checklists Salvos</h2>
                <div id="savedDates" class="saved-dates">
                    <!-- Datas salvas serão carregadas aqui -->
                </div>
            </div>

            <div class="card" id="adminSection" style="display: none;">
                <h2>Administração</h2>
                <p>Visualize todos os checklists dos funcionários</p>
                <div id="allSavedDates" class="saved-dates">
                    <!-- Todos os checklists serão carregados aqui -->
                </div>

                <!-- Seção de Backup e Restauração -->
                <div class="backup-section">
                    <h2>Backup e Restauração de Dados</h2>
                    <p>Faça backup de todos os dados do sistema ou restaure de um backup anterior</p>
                    
                    <div class="backup-actions">
                        <button id="backupBtn" class="btn btn-success">
                            Fazer Backup
                        </button>
                        <button id="restoreBtn" class="btn btn-warning">
                            Restaurar Backup
                        </button>
                        <button id="clearAllDataBtn" class="btn btn-danger">
                            Limpar Todos os Dados
                        </button>
                    </div>

                    <div class="backup-info">
                        <strong>Informações sobre backup:</strong>
                        <ul>
                            <li>O backup inclui todos os usuários e checklists salvos</li>
                            <li>O arquivo de backup é criptografado e seguro</li>
                            <li>Recomenda-se fazer backup regularmente</li>
                            <li>A restauração substituirá todos os dados atuais</li>
                        </ul>
                    </div>

                    <div id="backupMessage" style="margin-top: 15px; padding: 10px; border-radius: 5px; display: none;"></div>
                </div>
            </div>
        </div>

        <!-- Checklist Screen - SEM ÍCONES -->
        <div id="checklistScreen" class="screen">
            <div class="header">
                <div>
                    <h2 id="dateTitle">Checklist do dia: </h2>
                    <div class="progress-container">
                        <div class="progress-text" id="progressText">0% concluído (0/25 itens)</div>
                        <div class="progress-bar">
                            <div class="progress" id="progressBar"></div>
                        </div>
                    </div>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button id="backBtn" class="btn btn-secondary">Voltar</button>
                    <button id="clearBtn" class="btn btn-danger">Limpar</button>
                    <button id="exportPDFBtn" class="btn btn-success">Exportar PDF</button>
                </div>
            </div>

            <div id="checklistContent">
                <!-- Conteúdo do checklist será carregado aqui -->
            </div>

            <div class="divider"></div>

            <div class="checklist-actions">
                <button id="backBtn2" class="btn btn-secondary">Voltar</button>
                <button id="clearBtn2" class="btn btn-danger">Limpar</button>
                <button id="exportPDFBtn2" class="btn btn-success">Exportar PDF</button>
            </div>

            <div class="image-attachments">
                <div class="image-attachment">
                    <span>Anexar Imagem</span>
                </div>
                <div class="image-attachment">
                    <span>Anexar Imagem</span>
                </div>
                <div class="image-attachment">
                    <span>Anexar Imagem</span>
                </div>
            </div>
        </div>

        <!-- User Management Screen -->
        <div id="userManagementScreen" class="screen">
            <div class="header">
                <div class="header-logo">
                    <!-- Logo com caminho correto -->
                    <img src="images/logo-gela-boca.png" alt="Gela Boca" onerror="this.style.display='none';">
                    <div class="header-title">Gerenciamento de Usuários</div>
                </div>
                <button id="backToHomeBtn" class="btn btn-secondary">Voltar ao Início</button>
            </div>

            <div class="card">
                <h2>Adicionar Novo Usuário</h2>
                <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                    <div class="input-group" style="flex: 1; min-width: 200px;">
                        <label for="newUsername">Nome de Usuário</label>
                        <input type="text" id="newUsername" placeholder="Digite o nome de usuário">
                    </div>
                    <div class="input-group" style="flex: 1; min-width: 200px;">
                        <label for="newPassword">Senha</label>
                        <input type="password" id="newPassword" placeholder="Digite a senha">
                    </div>
                    <div style="align-self: flex-end;">
                        <button id="addUserBtn" class="btn">Adicionar Usuário</button>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>Usuários Existentes</h2>
                <div id="usersList" class="user-list">
                    <!-- Lista de usuários será carregada aqui -->
                </div>
            </div>
        </div>

        <!-- Create Account Modal -->
        <div id="createAccountModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Criar Novo Acesso</h2>
                    <button class="close-modal">&times;</button>
                </div>
                <div class="input-group">
                    <label for="newUserUsername">Nome de Usuário</label>
                    <input type="text" id="newUserUsername" placeholder="Digite o nome de usuário">
                </div>
                <div class="input-group">
                    <label for="newUserPassword">Senha</label>
                    <input type="password" id="newUserPassword" placeholder="Digite a senha">
                </div>
                <div class="input-group">
                    <label for="newUserConfirmPassword">Confirmar Senha</label>
                    <input type="password" id="newUserConfirmPassword" placeholder="Confirme a senha">
                </div>
                <button id="confirmCreateAccountBtn" class="btn" style="width: 100%;">Criar Acesso</button>
                <p id="createAccountMsg" style="color: var(--magenta-escuro); margin-top: 15px; text-align: center;"></p>
            </div>
        </div>

        <!-- Forgot Password Modal -->
        <div id="forgotPasswordModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Recuperar Senha</h2>
                    <button class="close-modal">&times;</button>
                </div>
                <div class="input-group">
                    <label for="recoveryUsername">Nome de Usuário</label>
                    <input type="text" id="recoveryUsername" placeholder="Digite seu nome de usuário">
                </div>
                <div class="input-group">
                    <label for="recoveryEmail">E-mail de Recuperação</label>
                    <input type="email" id="recoveryEmail" placeholder="Digite seu e-mail">
                </div>
                <button id="confirmRecoveryBtn" class="btn" style="width: 100%;">Enviar Link de Recuperação</button>
                <p id="recoveryMsg" style="color: var(--magenta-escuro); margin-top: 15px; text-align: center;"></p>
                <p style="font-size: 0.9rem; color: var(--cinza); margin-top: 15px; text-align: center;">
                    <strong>Usuários existentes:</strong><br>
                    Douglas, Wilmara, Juliana, Admin
                </p>
            </div>
        </div>

        <!-- Modal para visualizar imagem -->
        <div id="imageModal" class="image-modal">
            <span class="close-modal">&times;</span>
            <div class="image-modal-content">
                <img id="modalImage" src="" alt="Imagem ampliada">
            </div>
        </div>

        <!-- Modal de Confirmação de Restauração -->
        <div id="restoreConfirmModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Confirmar Restauração</h2>
                    <button class="close-modal">&times;</button>
                </div>
                <p><strong>Atenção:</strong> Esta ação irá substituir todos os dados atuais do sistema pelos dados do backup. Todos os usuários e checklists atuais serão perdidos.</p>
                <p>Deseja continuar?</p>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button id="confirmRestoreBtn" class="btn btn-warning">Sim, Restaurar</button>
                    <button id="cancelRestoreBtn" class="btn btn-secondary">Cancelar</button>
                </div>
            </div>
        </div>

        <!-- Modal de Confirmação de Limpeza -->
        <div id="clearAllConfirmModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Confirmar Limpeza</h2>
                    <button class="close-modal">&times;</button>
                </div>
                <p><strong>Atenção:</strong> Esta ação irá apagar todos os dados do sistema, incluindo todos os usuários e checklists. Esta ação não pode ser desfeita.</p>
                <p>Deseja continuar?</p>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button id="confirmClearAllBtn" class="btn btn-danger">Sim, Limpar Tudo</button>
                    <button id="cancelClearAllBtn" class="btn btn-secondary">Cancelar</button>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>Sistema de Checklist Gela Boca &copy; 2023/2024</p>
        </div>
    </div>

    <!-- JavaScript Local -->
    <script src="js/jspdf.umd.min.js"></script>
    <script src="js/html2canvas.min.js"></script>
    <script>
        // Sistema de usuários
        let users = JSON.parse(localStorage.getItem('checklist_users')) || {
            "Douglas": "Douglasgela01",
            "Wilmara": "Wilmaragela02",
            "Juliana": "Julianagela00",
            "Admin": "admin123"
        };
        
        let loggedUser = null;
        let selectedChecklist = 'abertura';
        let currentDate = '';

        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            saveUsers();
            setupEventListeners();
            document.getElementById('selectedDate').value = new Date().toISOString().slice(0,10);
            
            // Resetar todas as permissões ao carregar a página
            resetPermissions();
            
            // Selecionar o primeiro checklist por padrão
            document.querySelector('.checklist-option').classList.add('selected');
        });

        function saveUsers() {
            localStorage.setItem('checklist_users', JSON.stringify(users));
        }

        // Função para resetar todas as permissões
        function resetPermissions() {
            document.getElementById('adminSection').style.display = 'none';
            document.getElementById('userManagementBtn').style.display = 'none';
        }

        // Função para aplicar permissões baseadas no usuário logado
        function applyUserPermissions() {
            resetPermissions(); // Primeiro resetamos tudo
            
            if (loggedUser === "Admin") {
                document.getElementById('adminSection').style.display = 'block';
                document.getElementById('userManagementBtn').style.display = 'inline-block';
            }
        }

        function setupEventListeners() {
            // Login
            document.getElementById('loginBtn').onclick = handleLogin;
            document.getElementById('logoutBtn').onclick = handleLogout;
            
            // Novas funcionalidades de login
            document.getElementById('createAccountBtn').onclick = showCreateAccountModal;
            document.getElementById('forgotPasswordBtn').onclick = showForgotPasswordModal;
            
            // Navegação
            document.getElementById('userManagementBtn').onclick = showUserManagement;
            document.getElementById('backToHomeBtn').onclick = showHomeScreen;
            document.getElementById('changePasswordBtn').onclick = changePassword;
            
            // Gerenciamento de usuários
            document.getElementById('addUserBtn').onclick = addNewUser;
            
            // Modais
            document.getElementById('confirmCreateAccountBtn').onclick = createNewAccount;
            document.getElementById('confirmRecoveryBtn').onclick = handlePasswordRecovery;
            
            // Backup e Restauração
            document.getElementById('backupBtn').onclick = createBackup;
            document.getElementById('restoreBtn').onclick = showRestoreModal;
            document.getElementById('clearAllDataBtn').onclick = showClearAllModal;
            document.getElementById('confirmRestoreBtn').onclick = restoreBackup;
            document.getElementById('cancelRestoreBtn').onclick = closeRestoreModal;
            document.getElementById('confirmClearAllBtn').onclick = clearAllData;
            document.getElementById('cancelClearAllBtn').onclick = closeClearAllModal;
            
            // Fechar modais
            document.querySelectorAll('.close-modal').forEach(btn => {
                btn.onclick = function() {
                    this.closest('.modal').classList.remove('active');
                    document.getElementById('imageModal').style.display = 'none';
                };
            });
            
            // Checklist
            document.getElementById('openBtn').onclick = () => openChecklist();
            document.getElementById('todayBtn').onclick = () => {
                document.getElementById('selectedDate').value = new Date().toISOString().slice(0,10);
            };
            document.getElementById('backBtn').onclick = showHomeScreen;
            document.getElementById('backBtn2').onclick = showHomeScreen;
            document.getElementById('clearBtn').onclick = clearChecks;
            document.getElementById('clearBtn2').onclick = clearChecks;
            document.getElementById('exportPDFBtn').onclick = exportPDF;
            document.getElementById('exportPDFBtn2').onclick = exportPDF;

            // Seleção de checklist
            document.querySelectorAll('.checklist-option').forEach(option => {
                option.onclick = function() {
                    document.querySelectorAll('.checklist-option').forEach(opt => opt.classList.remove('selected'));
                    this.classList.add('selected');
                    selectedChecklist = this.dataset.checklist;
                };
            });

            // Enter para login
            document.getElementById('password').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    handleLogin();
                }
            });
            
            // Anexar imagens
            document.querySelectorAll('.image-attachment').forEach(attachment => {
                attachment.addEventListener('click', function() {
                    alert('Abrindo seletor de imagens...');
                });
            });
        }

        // Funções de Backup e Restauração
        function createBackup() {
            try {
                // Coletar todos os dados do localStorage relacionados ao checklist
                const backupData = {
                    checklist_users: localStorage.getItem('checklist_users'),
                    timestamp: new Date().toISOString(),
                    version: '1.0',
                    data: {}
                };

                // Coletar todos os checklists salvos
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key.startsWith('checklist_')) {
                        backupData.data[key] = localStorage.getItem(key);
                    }
                }

                // Criar arquivo de backup
                const backupBlob = new Blob([JSON.stringify(backupData, null, 2)], {
                    type: 'application/json'
                });

                // Criar link para download
                const backupUrl = URL.createObjectURL(backupBlob);
                const a = document.createElement('a');
                a.href = backupUrl;
                a.download = `backup_checklist_gelaboca_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(backupUrl);

                showBackupMessage('Backup criado com sucesso!', 'success');
            } catch (error) {
                console.error('Erro ao criar backup:', error);
                showBackupMessage('Erro ao criar backup: ' + error.message, 'error');
            }
        }

        function showRestoreModal() {
            document.getElementById('restoreConfirmModal').classList.add('active');
        }

        function closeRestoreModal() {
            document.getElementById('restoreConfirmModal').classList.remove('active');
        }

        function showClearAllModal() {
            document.getElementById('clearAllConfirmModal').classList.add('active');
        }

        function closeClearAllModal() {
            document.getElementById('clearAllConfirmModal').classList.remove('active');
        }

        function restoreBackup() {
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.accept = '.json';
            
            fileInput.onchange = function(event) {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const backupData = JSON.parse(e.target.result);
                        
                        // Validar estrutura do backup
                        if (!backupData.checklist_users || !backupData.data) {
                            throw new Error('Arquivo de backup inválido');
                        }

                        // Fazer backup dos dados atuais antes da restauração
                        const currentBackup = {
                            checklist_users: localStorage.getItem('checklist_users'),
                            data: {}
                        };

                        for (let i = 0; i < localStorage.length; i++) {
                            const key = localStorage.key(i);
                            if (key.startsWith('checklist_')) {
                                currentBackup.data[key] = localStorage.getItem(key);
                            }
                        }

                        // Restaurar dados do backup
                        localStorage.setItem('checklist_users', backupData.checklist_users);
                        
                        // Limpar dados antigos
                        for (let i = 0; i < localStorage.length; i++) {
                            const key = localStorage.key(i);
                            if (key.startsWith('checklist_')) {
                                localStorage.removeItem(key);
                            }
                        }

                        // Restaurar novos dados
                        Object.keys(backupData.data).forEach(key => {
                            localStorage.setItem(key, backupData.data[key]);
                        });

                        closeRestoreModal();
                        showBackupMessage('Backup restaurado com sucesso! O sistema será recarregado.', 'success');
                        
                        // Recarregar a página após 2 segundos
                        setTimeout(() => {
                            location.reload();
                        }, 2000);

                    } catch (error) {
                        console.error('Erro ao restaurar backup:', error);
                        showBackupMessage('Erro ao restaurar backup: ' + error.message, 'error');
                    }
                };
                reader.readAsText(file);
            };
            
            fileInput.click();
        }

        function clearAllData() {
            try {
                // Limpar todos os dados do sistema
                localStorage.clear();
                
                // Reinicializar usuários padrão
                users = {
                    "Douglas": "Douglasgela01",
                    "Wilmara": "Wilmaragela02",
                    "Juliana": "Julianagela00",
                    "Admin": "admin123"
                };
                saveUsers();
                
                closeClearAllModal();
                showBackupMessage('Todos os dados foram limpos com sucesso! O sistema será recarregado.', 'success');
                
                // Recarregar a página após 2 segundos
                setTimeout(() => {
                    location.reload();
                }, 2000);
            } catch (error) {
                console.error('Erro ao limpar dados:', error);
                showBackupMessage('Erro ao limpar dados: ' + error.message, 'error');
            }
        }

        function showBackupMessage(message, type) {
            const messageElement = document.getElementById('backupMessage');
            messageElement.textContent = message;
            messageElement.style.display = 'block';
            messageElement.style.backgroundColor = type === 'success' ? 'var(--azul-claro)' : 'var(--rosa-claro)';
            messageElement.style.color = type === 'success' ? 'var(--azul)' : 'var(--magenta-escuro)';
            messageElement.style.border = `1px solid ${type === 'success' ? 'var(--azul)' : 'var(--magenta)'}`;
            
            setTimeout(() => {
                messageElement.style.display = 'none';
            }, 5000);
        }

        function showCreateAccountModal() {
            document.getElementById('createAccountModal').classList.add('active');
            document.getElementById('newUserUsername').value = '';
            document.getElementById('newUserPassword').value = '';
            document.getElementById('newUserConfirmPassword').value = '';
            document.getElementById('createAccountMsg').textContent = '';
        }

        function showForgotPasswordModal() {
            document.getElementById('forgotPasswordModal').classList.add('active');
            document.getElementById('recoveryUsername').value = '';
            document.getElementById('recoveryEmail').value = '';
            document.getElementById('recoveryMsg').textContent = '';
        }

        function createNewAccount() {
            const username = document.getElementById('newUserUsername').value.trim();
            const password = document.getElementById('newUserPassword').value.trim();
            const confirmPassword = document.getElementById('newUserConfirmPassword').value.trim();
            const msgElement = document.getElementById('createAccountMsg');

            if (!username || !password || !confirmPassword) {
                msgElement.textContent = 'Preencha todos os campos!';
                return;
            }

            if (password !== confirmPassword) {
                msgElement.textContent = 'As senhas não coincidem!';
                return;
            }

            if (password.length < 6) {
                msgElement.textContent = 'A senha deve ter pelo menos 6 caracteres!';
                return;
            }

            if (users[username]) {
                msgElement.textContent = 'Usuário já existe!';
                return;
            }

            // Criar novo usuário
            users[username] = password;
            saveUsers();
            
            msgElement.style.color = 'var(--azul)';
            msgElement.textContent = 'Acesso criado com sucesso! Você já pode fazer login.';
            
            // Limpar campos após 2 segundos e fechar modal
            setTimeout(() => {
                document.getElementById('createAccountModal').classList.remove('active');
                document.getElementById('newUserUsername').value = '';
                document.getElementById('newUserPassword').value = '';
                document.getElementById('newUserConfirmPassword').value = '';
                document.getElementById('createAccountMsg').textContent = '';
            }, 2000);
        }

        function handlePasswordRecovery() {
            const username = document.getElementById('recoveryUsername').value.trim();
            const email = document.getElementById('recoveryEmail').value.trim();
            const msgElement = document.getElementById('recoveryMsg');

            if (!username || !email) {
                msgElement.textContent = 'Preencha todos os campos!';
                return;
            }

            if (!users[username]) {
                msgElement.textContent = 'Usuário não encontrado!';
                return;
            }

            // Simular envio de e-mail (em um sistema real, isso enviaria um e-mail real)
            msgElement.style.color = 'var(--azul)';
            msgElement.textContent = 'Link de recuperação enviado para o e-mail!';
            
            // Em um sistema real, você enviaria um e-mail com um link para redefinir a senha
            // Por enquanto, vamos apenas mostrar uma mensagem
            setTimeout(() => {
                document.getElementById('forgotPasswordModal').classList.remove('active');
                msgElement.textContent = '';
            }, 3000);
        }

        function handleLogin() {
            const user = document.getElementById('username').value.trim();
            const pass = document.getElementById('password').value.trim();
            
            if(users[user] && users[user] === pass){
                loggedUser = user;
                document.getElementById('loginScreen').classList.remove('active');
                document.getElementById('homeScreen').classList.add('active');
                document.getElementById('userWelcome').textContent = `Bem-vindo, ${user}`;
                document.getElementById('userAvatar').textContent = user.charAt(0).toUpperCase();
                
                // Aplicar permissões específicas do usuário
                applyUserPermissions();
                
                renderSavedDates();
            } else { 
                document.getElementById('loginMsg').textContent = 'Usuário ou senha inválidos!'; 
            }
        }

        function handleLogout() {
            loggedUser = null;
            
            // Resetar todas as permissões ao fazer logout
            resetPermissions();
            
            document.getElementById('homeScreen').classList.remove('active');
            document.getElementById('userManagementScreen').classList.remove('active');
            document.getElementById('checklistScreen').classList.remove('active');
            document.getElementById('loginScreen').classList.add('active');
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            document.getElementById('loginMsg').textContent = '';
        }

        function showUserManagement() {
            // Verificar se o usuário atual é admin antes de permitir acesso
            if (loggedUser !== "Admin") {
                alert('Acesso negado! Apenas administradores podem gerenciar usuários.');
                return;
            }
            
            document.getElementById('homeScreen').classList.remove('active');
            document.getElementById('userManagementScreen').classList.add('active');
            renderUsersList();
        }

        function showHomeScreen() {
            document.getElementById('userManagementScreen').classList.remove('active');
            document.getElementById('checklistScreen').classList.remove('active');
            document.getElementById('homeScreen').classList.add('active');
            
            // Reaplicar permissões ao voltar para a tela inicial
            applyUserPermissions();
            
            renderSavedDates();
        }

        function changePassword() {
            const newPassword = prompt('Digite a nova senha:');
            if (newPassword && newPassword.length >= 6) {
                users[loggedUser] = newPassword;
                saveUsers();
                alert('Senha alterada com sucesso!');
            } else {
                alert('Senha deve ter pelo menos 6 caracteres!');
            }
        }

        function addNewUser() {
            // Verificar se o usuário atual é admin
            if (loggedUser !== "Admin") {
                alert('Acesso negado! Apenas administradores podem adicionar usuários.');
                return;
            }
            
            const newUser = document.getElementById('newUsername').value.trim();
            const newPass = document.getElementById('newPassword').value.trim();
            
            if (!newUser || !newPass) {
                alert('Preencha todos os campos!');
                return;
            }
            
            if (newPass.length < 6) {
                alert('A senha deve ter pelo menos 6 caracteres!');
                return;
            }
            
            if (users[newUser]) {
                alert('Usuário já existe!');
                return;
            }
            
            users[newUser] = newPass;
            saveUsers();
            renderUsersList();
            
            document.getElementById('newUsername').value = '';
            document.getElementById('newPassword').value = '';
            alert('Usuário adicionado com sucesso!');
        }

        function renderUsersList() {
            const usersList = document.getElementById('usersList');
            usersList.innerHTML = '';
            
            Object.keys(users).forEach(username => {
                if (username === 'Admin') return; // Não mostrar admin na lista de exclusão
                
                const userDiv = document.createElement('div');
                userDiv.className = 'user-item';
                userDiv.innerHTML = `
                    <div>
                        <strong>${username}</strong>
                    </div>
                    <div class="user-actions">
                        <button class="btn btn-danger btn-small" onclick="deleteUser('${username}')">Excluir</button>
                    </div>
                `;
                usersList.appendChild(userDiv);
            });
        }

        function deleteUser(username) {
            // Verificar se o usuário atual é admin
            if (loggedUser !== "Admin") {
                alert('Acesso negado! Apenas administradores podem excluir usuários.');
                return;
            }
            
            if (confirm(`Tem certeza que deseja excluir o usuário ${username}?`)) {
                delete users[username];
                saveUsers();
                renderUsersList();
            }
        }

        function item(id, text){ 
            return `
                <div class="checklist-item" id="item_${id}">
                    <div style="display: flex; align-items: flex-start; width: 100%;">
                        <input type="checkbox" data-id="item_${id}" id="checkbox_${id}">
                        <label for="checkbox_${id}" style="flex: 1;">${text}</label>
                    </div>
                    <div class="image-upload-container">
                        <input type="file" accept="image/*" id="file_${id}" style="display: none;" onchange="handleImageUpload('${id}')">
                        <button type="button" class="btn btn-secondary btn-small" onclick="document.getElementById('file_${id}').click()">
                            Anexar Imagem
                        </button>
                        <div class="image-preview" id="preview_${id}"></div>
                    </div>
                </div>
            `; 
        }

        function handleImageUpload(itemId) {
            const fileInput = document.getElementById(`file_${itemId}`);
            const file = fileInput.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const imageData = e.target.result;
                const preview = document.getElementById(`preview_${itemId}`);
                
                // Criar elemento de preview da imagem
                const imageItem = document.createElement('div');
                imageItem.className = 'image-item';
                imageItem.innerHTML = `
                    <img src="${imageData}" alt="Imagem anexada">
                    <div class="image-actions">
                        <button class="image-action-btn" onclick="viewImage('${imageData}')">
                            Ver
                        </button>
                        <button class="image-action-btn" onclick="removeImage('${itemId}', this)">
                            Excluir
                        </button>
                    </div>
                `;
                
                preview.appendChild(imageItem);
                saveState(currentDate);
            };
            reader.readAsDataURL(file);
        }

        function viewImage(imageData) {
            document.getElementById('modalImage').src = imageData;
            document.getElementById('imageModal').style.display = 'flex';
        }

        function removeImage(itemId, button) {
            const imageItem = button.closest('.image-item');
            imageItem.remove();
            saveState(currentDate);
        }

        function openChecklist(dateParam){
            let date = dateParam || document.getElementById('selectedDate').value;
            if(!date){ alert('Escolha uma data!'); return; }

            currentDate = date;
            document.getElementById('selectedDate').value = date;
            document.getElementById('homeScreen').classList.remove('active');
            document.getElementById('checklistScreen').classList.add('active');
            document.getElementById('dateTitle').textContent = `Checklist do dia: ${date}`;
            document.getElementById('checklistContent').innerHTML = getChecklistHTML(selectedChecklist);
            loadState(date);
            updateProgress();
            
            // Adicionar listeners de mudança
            document.querySelectorAll('#checklistContent input[type=checkbox]').forEach(cb => {
                cb.onchange = () => {
                    saveState(date);
                    updateProgress();
                    // Adicionar/remover classe checked
                    const item = cb.closest('.checklist-item');
                    if(cb.checked) {
                        item.classList.add('checked');
                    } else {
                        item.classList.remove('checked');
                    }
                };
            });
        }

        function updateProgress() {
            const checkboxes = document.querySelectorAll('#checklistContent input[type=checkbox]');
            if (checkboxes.length === 0) return;
            
            const checked = document.querySelectorAll('#checklistContent input[type=checkbox]:checked').length;
            const total = checkboxes.length;
            const percentage = Math.round((checked / total) * 100);
            
            document.getElementById('progressBar').style.width = `${percentage}%`;
            document.getElementById('progressText').textContent = `${percentage}% concluído (${checked}/${total} itens)`;
        }

        function getChecklistHTML(type) {
            const checklists = {
                abertura: `
                    <div class="card checklist-section">
                        <h2>CHECKLIST DE ABERTURA DE LOJA</h2>
                        ${item(1,'Ligar iluminação da loja.')}
                        ${item(2,'Ligar ar-condicionado loja e cozinha (caso seja necessário) em ________º DIAS DE CHUVA E FRIO -- NÃO LIGAR')}
                        ${item(3,'Ligar cortinas de ar. (caso ar condicionado da loja esteja ligado)')}
                        ${item(4,'Abrir caixa e loja no Ifood (Gela Boca e Ultraçaí) -- pegar crachá de identificação.')}
                        ${item(5,'Ligar sistema de som, maquininhas de cartão, tablete e celular (verificar as baterias -- recarregar se necessário)')}
                        ${item(6,'Levar mesas, cadeiras e guarda-sóis para fuera e organizá-los, limpando caso necessário, verificar calçadas se precisa limpar.')}
                        ${item(7,'Verificar cubas auto limpantes, limpar (caso precise) e colocar boleadores')}
                        ${item(8,'Abrir cremes e limpar as bordas - caso seja necessário')}
                        ${item(9,'Limpar a mesa fria (ver validade) e trocar a água (caso necessário) e ligar o gira choco esperar esquentar primeiro, para depois ligar a roda.')}
                        ${item(10,'Ligar botão "quente" da mesa fria e iluminação (os 2 últimos)')}
                        ${item(11,'Limpar as bordas das sobremesas e cremes, colocar na mesa fria (conferir validade) -- provar a salada de frutas antes de colocar')}
                        ${item(12,'Reabastecer e limpar as bisnagas da mesa fria (conferir validades), finalizando com a recolocação na mesa fria.')}
                        ${item(13,'Limpar chão (se necessário) os vidros dos freezers e bordas, a mesa fria e granitos das cubas')}
                        ${item(14,'Tirar pó e reabastecer as prateleiras (não esquecer das casquinhas);')}
                        ${item(15,'Conferir e colocar placas de identificação em todos os sorvetes.')}
                        ${item(16,'Reabastecer colheres, pazinhas, guardanapos, canudos, guloseimas e porta guardanapos do balcão (Anotar o que estiver acabando)')}
                        ${item(17,'Abrir janelas da área kids -- limpar chão se necessário.')}
                        ${item(18,'Manter pote das cestinhas fechada e abastecidas.')}
                        ${item(19,'Tirar pó de todas as mesas e cadeiras internas.')}
                        ${item(20,'Reabastecer e organizar freezers, de sorvetes e potes, espátular (caso necessário) IMPORTANTE OBSERVAR A LINHA VERMELHA , reabastecer o freezer de bebidas e anotar o que estiver acabando.')}
                        ${item(21,'Conferir cardápio, sabores de picolés, de sorvetes, etc, para Ifood.')}
                        ${item(22,'Verificar os dispenser de papel, sabonete, álcool gel e reabastecer caso necessário (cozinha, banheiros e salão).')}
                        ${item(23,'Verificar e limpar cardápios se necessário, organizar, tirar pó do balcão do caixa e passar um pano da balança;')}
                        ${item(24,'Passar pano com álcool no corrimão -- dois lados e conferir a limpeza dos banheiros, lixeirinhos')}
                        ${item(25,'Enviar fotos por whatsapp do checklist cumprido (com o assinatura /nome em caneta em cada item cumprido)')}
                    </div>
                `,
                
                cozinha: `
                    <div class="card checklist-section">
                        <h2>GELA BOCA - CHECKLIST COZINHA</h2>
                        ${item(1,'LIGAR A CREPEIRA A 50º DURANTE O DIA --- PARA PRODUÇÃO MANTER E ______ o')}
                        ${item(2,'VERIFICAR SE TEMOS MAMÃO, MAÇA E MELÃO E SE ESTÃO DEVIDAMENTE ARMAZENADOS')}
                        ${item(3,'VERIFICAR SE TEMOS MORANGOS, UVAS E KIWI LAVADOS E DEVIDAMENTE ARMAZENADOS')}
                        ${item(4,'VERIFICAR SE TEMOS MASSA OF CREPE PRONTA')}
                        ${item(5,'VERIFICAR SE TEMOS FRANGO FRACIONADO E VALIDADE - ______ PACOTE')}
                        ${item(6,'VERIFICAR SE TEMOS QUEIJO/PRESUNTO FRACIONADO E VALIDADE - ______')}
                        ${item(7,'VERIFICAR SE TEMOS CALABRESA FRACIONADO E VALIDADE - ______ PACOTE')}
                        ${item(8,'VERIFICAR SE TEMOS BEIJINHO ENROLADO E VALIDADE')}
                        ${item(9,'VERIFICAR SE TEMOS BRIGADEIRO ENROLADO E VALIDADE')}
                        ${item(10,'VERIFICAR SE TEMOS 04 PACOTES DE TORRADAS')}
                        ${item(11,'VERIFICAR SE TEMOS CAPUCCINO PRONTO')}
                        ${item(12,'VERIFICAR SE TEMOS 10 COMPOTAS DE MORANGO')}
                        ${item(13,'VERIFICAR SE TEMOS CHANTILY BATIDO E DEVIDAMENTE ARMAZENADO')}
                        ${item(14,'VERIFICAR E ABASTECER LUVAS DE CHANTILY')}
                        ${item(15,'VERIFICAR E ABASTECER POTES DE ADICIONAIS DA BANCADA')}
                        ${item(16,'DEIXAR 6 BASE DE AÇÃI DE 300 KG PRONTO')}
                        ${item(17,'DEIXAR 6 BASES DE AÇAI 500 KG PRONTO')}
                        ${item(18,'DEIXAR 6 POTES DE GANACHE PRETA E BRANCO PRONTAS')}
                        ${item(19,'VERIFICAR AS VALIDADES DOS INSUMOS E PRODUTOS')}
                    </div>
                `,
                
                'cozinha-fechamento': `
                    <div class="card checklist-section">
                        <h2>CHECK LIST COZINHA (FECHAMENTO)</h2>
                        ${item(1,'NÃO ESQUECER a crepeira ligada -- DESLIGAR')}
                        ${item(2,'Lavar utensílios usados - deixar a pia seca e limpa -- mandar foto.')}
                        ${item(3,'Verificar se potes estão bem fechados e ver a necessidade de fazer reposição de produtos e insumos. (anotar o que está acabando)')}
                        ${item(4,'*Limpar os eletrodomésticos utilizados, principalmente crepeira e microondas')}
                        ${item(5,'Organizar prateleiras e passar pano com álcool')}
                        ${item(6,'Limpar o vidro do freezer e borda - quando necessário por fora com pano sem álcool.')}
                        ${item(7,'Passar pano com álcool por fora da geladeira e na câmara fria')}
                        ${item(8,'Não deixar louça na pia')}
                        ${item(9,'Varrer e passar pano na cozinha.')}
                        ${item(10,'Depois da limpeza, jogar água do MOP na torneira lá fora - não jogar nas pias da loja e nem vaso sanitário.')}
                        ${item(11,'Guardar MOP e vassouras no local correto -- panos usados em balde')}
                        ${item(12,'Desligar ar-condicionado da cozinha -- assim que acabar as produções')}
                        ${item(13,'Verificar os panos de limpeza e da cozinha estão no local correto (organizados e dobrados os sem uso e usados e sujos e sacola plástica para entregar Juliana.')}
                        ${item(14,'Apagar todas as luzes, leds e inclusive luminoso interno.')}
                        ${item(15,'Verificar se todos os freezers, geladeira e câmara fria estão devidamente fechados.')}
                        ${item(16,'Enviar fotos por whatsapp do checklist cumprido (com o assinatura /nome em caneta em cada item cumprido).')}
                    </div>
                `,
                
                fechamento: `
                    <div class="card checklist-section">
                        <h2>CHECKLIST FECHAMENTO</h2>
                        ${item(1,'Desligar ar-condicionado e cortinas de ar do salão as _______h caso esteja ligado.')}
                        ${item(2,'As ____:______ Fechar área kids e janelas.')}
                        ${item(3,'Recolher guarda-sol as ____:_____ horas nos dias de semana e ____:_____ nos finais de semana (senão houver clientes utilizando). Deixar no debaixo da escada sem encostar nas paredes.')}
                        ${item(4,'Fechar buffet as _____:________ e a porta principal as _____:________')}
                        ${item(5,'Fechar caixa da loja e enviar foto para o Juliana (foto: tela de fechamento, comprovantes das maquininhas e de sangria / suprimentos.')}
                        ${item(6,'Retirar boleadores, colheres, conchas da mesa fria para lavar e dos cremes ver a necessidade.')}
                        ${item(7,'Desligar crepeira e deixar limpa')}
                        ${item(8,'Tampar / papel plástico filme em todos os potes de guloseimas e cremes')}
                        ${item(9,'Tampar as sobremesas e frutas com calda com plástico filme e guardar na geladeira embaixo da mesa fria.')}
                        ${item(10,'Tampar pote das cestinhas')}
                        ${item(11,'Desligar o gira choco, esperar esfriar e passar o papel plastico filme')}
                        ${item(12,'Desligar a luz e botão "quente" da mesa fria (os 2 últimos). Não desligar botão de refrigeração.')}
                        ${item(13,'Passar pano e recolher todo lixo do salão e banheiros - trocar saco lixo -- se necessário e limpar tampas das lixeiras.')}
                        ${item(14,'Depois da limpeza, jogar água do MOP na torneira lá fora - não jogar nas pias da loja e nem vaso sanitário.')}
                        ${item(15,'Guardar MOP e vassouras no local correto.')}
                        ${item(16,'Colocar as maquininhas para carregar e verificar bobinas de cupom fiscal')}
                        ${item(17,'Desligar os computadores')}
                        ${item(18,'Guardar celular e tablet da loja no local apropriado -- verificar bateria.')}
                        ${item(19,'Verificar se todos os freezers e câmara fria estão ligados e fechados.')}
                        ${item(20,'Fechar a loja e ATIVAR ALARME')}
                        ${item(21,'Enviar fotos por whatsapp do checklist cumprido (com o assinatura /nome em caneta em cada item cumprido).')}
                    </div>
                `
            };
            
            return checklists[type] || checklists.abertura;
        }

        function saveState(date){
            const state = {};
            document.querySelectorAll('.checklist-item').forEach(item => {
                const id = item.id;
                const checkbox = item.querySelector('input[type="checkbox"]');
                const imagePreview = item.querySelector('.image-preview');
                const images = [];
                
                // Coletar todas as imagens do item
                imagePreview.querySelectorAll('img').forEach(img => {
                    images.push(img.src);
                });
                
                state[id] = {
                    checked: checkbox.checked,
                    images: images
                };
            });
            localStorage.setItem(`checklist_${loggedUser}_${selectedChecklist}_${date}`, JSON.stringify(state));
            renderSavedDates();
        }

        function loadState(date){
            const raw = localStorage.getItem(`checklist_${loggedUser}_${selectedChecklist}_${date}`);
            if(!raw) return;
            const state = JSON.parse(raw);
            
            for (const [id, itemState] of Object.entries(state)) {
                const checkbox = document.querySelector(`#${id} input[type="checkbox"]`);
                if (checkbox) {
                    checkbox.checked = itemState.checked;
                    // Aplicar classe checked se necessário
                    const item = checkbox.closest('.checklist-item');
                    if(itemState.checked) {
                        item.classList.add('checked');
                    } else {
                        item.classList.remove('checked');
                    }
                }
                
                const preview = document.querySelector(`#${id} .image-preview`);
                if (preview && itemState.images && itemState.images.length > 0) {
                    preview.innerHTML = '';
                    itemState.images.forEach(imageData => {
                        const imageItem = document.createElement('div');
                        imageItem.className = 'image-item';
                        imageItem.innerHTML = `
                            <img src="${imageData}" alt="Imagem anexada">
                            <div class="image-actions">
                                <button class="image-action-btn" onclick="viewImage('${imageData}')">
                                    Ver
                                </button>
                                <button class="image-action-btn" onclick="removeImage('${id}', this)">
                                    Excluir
                                </button>
                            </div>
                        `;
                        preview.appendChild(imageItem);
                    });
                }
            }
        }

        function clearChecks(){
            const date = currentDate;
            if(!date) return;
            if(confirm('Limpar todas as marcações e imagens desta data?')){
                document.querySelectorAll('#checklistContent input[type=checkbox]').forEach(cb => {
                    cb.checked = false;
                    const item = cb.closest('.checklist-item');
                    item.classList.remove('checked');
                });
                
                document.querySelectorAll('.image-preview').forEach(preview => {
                    preview.innerHTML = '';
                });
                
                localStorage.removeItem(`checklist_${loggedUser}_${selectedChecklist}_${date}`);
                renderSavedDates();
                updateProgress();
            }
        }

        function renderSavedDates(){
            const out = document.getElementById('savedDates');
            out.innerHTML = '';
            const keys = Object.keys(localStorage).filter(k => k.startsWith(`checklist_${loggedUser}_`)).sort().reverse();
            
            if(keys.length === 0){ 
                out.innerHTML='<div style="text-align: center; padding: 20px; color: var(--cinza);">Nenhuma data salva ainda.</div>'; 
            }
            
            keys.forEach(k => {
                const parts = k.split('_');
                const checklistType = parts[2];
                const date = parts[3];
                const div = document.createElement('div');
                div.className = 'date-card';
                div.innerHTML = `
                    <div class="date">${date}</div>
                    <div class="checklist-type">${checklistType}</div>
                `;
                div.onclick = () => {
                    selectedChecklist = checklistType;
                    document.querySelectorAll('.checklist-option').forEach(opt => {
                        opt.classList.toggle('selected', opt.dataset.checklist === checklistType);
                    });
                    openChecklist(date);
                };
                out.appendChild(div);
            });

            // Visualização do admin - APENAS se o usuário atual é admin
            if(loggedUser === "Admin"){
                const allOut = document.getElementById('allSavedDates');
                allOut.innerHTML = '';
                const allKeys = Object.keys(localStorage).filter(k => k.startsWith('checklist_')).sort().reverse();
                
                allKeys.forEach(k => {
                    const parts = k.split('_'); // checklist_user_checklistType_date
                    const user = parts[1], checklistType = parts[2], date = parts[3];
                    const div = document.createElement('div');
                    div.className = 'date-card';
                    div.innerHTML = `
                        <div class="date">${date}</div>
                        <div class="checklist-type">${user} - ${checklistType}</div>
                    `;
                    div.onclick = () => openChecklistForAdmin(user, checklistType, date);
                    allOut.appendChild(div);
                });
            }
        }

        function openChecklistForAdmin(user, checklistType, date){
            // Verificar se o usuário atual é admin
            if (loggedUser !== "Admin") {
                alert('Acesso negado! Apenas administradores podem visualizar checklists de outros usuários.');
                return;
            }
            
            loggedUser = user;
            selectedChecklist = checklistType;
            document.querySelectorAll('.checklist-option').forEach(opt => {
                opt.classList.toggle('selected', opt.dataset.checklist === checklistType);
            });
            openChecklist(date);
        }

        function exportPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const date = currentDate;
            
            // Configurações do PDF
            const pageWidth = doc.internal.pageSize.getWidth();
            const pageHeight = doc.internal.pageSize.getHeight();
            const margin = 20;
            let yPosition = margin;
            let pageNumber = 1;
            
            // Cores da identidade visual
            const magenta = [237, 41, 124];
            const azul = [118, 200, 218];
            const preto = [0, 0, 0];
            const cinza = [108, 117, 125];
            
            // Função para adicionar cabeçalho
            function addHeader(pageNum = 1) {
                // Cabeçalho com cor de fundo
                doc.setFillColor(...magenta);
                doc.rect(0, 0, pageWidth, 40, 'F');
                
                // Logo e título
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(20);
                doc.setFont('helvetica', 'bold');
                doc.text('GELA BOCA', pageWidth / 2, 15, { align: 'center' });
                doc.setFontSize(16);
                doc.text('SISTEMA DE CHECKLIST', pageWidth / 2, 25, { align: 'center' });
                
                // Informações do usuário e data
                doc.setFontSize(10);
                doc.text(`Usuário: ${loggedUser}`, margin, 35);
                doc.text(`Data: ${date}`, pageWidth - margin, 35, { align: 'right' });
                
                // Resetar cor do texto
                doc.setTextColor(...preto);
                doc.setFont('helvetica', 'normal');
                
                // Número da página
                doc.setFontSize(8);
                doc.setTextColor(150, 150, 150);
                doc.text(`Página ${pageNum}`, pageWidth / 2, pageHeight - 10, { align: 'center' });
            }
            
            // Função para adicionar nova página
            function addNewPage() {
                doc.addPage();
                pageNumber++;
                yPosition = margin + 40;
                addHeader(pageNumber);
            }
            
            // Função para adicionar caixa de seleção
            function addCheckbox(checked, x, y, size = 5) {
                doc.setDrawColor(...preto);
                doc.setLineWidth(0.5);
                doc.rect(x, y, size, size);
                
                if (checked) {
                    doc.setFillColor(...magenta);
                    doc.rect(x + 0.5, y + 0.5, size - 1, size - 1, 'F');
                    
                    // Adicionar ✓
                    doc.setTextColor(255, 255, 255);
                    doc.setFontSize(size - 1);
                    doc.text('✓', x + size/2, y + size/2 + 0.5, { align: 'center' });
                    doc.setTextColor(...preto);
                }
            }
            
            // Função para adicionar texto com quebra de linha
            function addText(text, x, y, maxWidth, fontSize = 10, isBold = false, color = preto) {
                doc.setFontSize(fontSize);
                doc.setFont('helvetica', isBold ? 'bold' : 'normal');
                doc.setTextColor(...color);
                
                const lines = doc.splitTextToSize(text, maxWidth);
                
                // Verificar se precisa de nova página
                const lineHeight = fontSize * 0.35;
                const totalHeight = lines.length * lineHeight;
                
                if (y + totalHeight > pageHeight - margin) {
                    addNewPage();
                    y = yPosition;
                }
                
                doc.text(lines, x, y);
                yPosition = y + totalHeight + 2;
                return yPosition;
            }
            
            // Adicionar cabeçalho na primeira página
            addHeader(pageNumber);
            yPosition = margin + 40;
            
            // Título do checklist
            const checklistTitle = selectedChecklist.toUpperCase();
            yPosition = addText(checklistTitle, pageWidth / 2, yPosition, pageWidth - 2 * margin, 16, true, magenta);
            yPosition += 10;
            
            // Conteúdo do checklist
            const sections = document.querySelectorAll('#checklistContent .checklist-section');
            let hasImages = false;
            const imagePages = [];
            
            sections.forEach(section => {
                const sectionTitle = section.querySelector('h2').textContent;
                
                // Adicionar linha decorativa antes do título da seção
                doc.setDrawColor(...azul);
                doc.setLineWidth(1);
                doc.line(margin, yPosition - 2, pageWidth - margin, yPosition - 2);
                yPosition += 5;
                
                // Título da seção
                yPosition = addText(sectionTitle, margin, yPosition, pageWidth - 2 * margin, 12, true, azul);
                yPosition += 5;
                
                const items = section.querySelectorAll('.checklist-item');
                items.forEach(item => {
                    const checkbox = item.querySelector('input[type="checkbox"]');
                    const label = item.querySelector('label');
                    const isChecked = checkbox.checked;
                    
                    // Posição X para a caixa de seleção e texto
                    const checkboxX = margin;
                    const textX = margin + 8;
                    const textWidth = pageWidth - 2 * margin - 8;
                    
                    // Adicionar caixa de seleção
                    addCheckbox(isChecked, checkboxX, yPosition - 3);
                    
                    // Adicionar texto do item
                    yPosition = addText(label.textContent, textX, yPosition, textWidth, 10, false, preto);
                    
                    // Verificar se há imagens para este item
                    const imagePreview = item.querySelector('.image-preview');
                    const images = imagePreview.querySelectorAll('img');
                    
                    if (images.length > 0) {
                        hasImages = true;
                        
                        images.forEach((img, index) => {
                            imagePages.push({
                                imageData: img.src,
                                itemText: label.textContent,
                                isChecked: isChecked,
                                user: loggedUser,
                                date: date,
                                checklistType: checklistTitle,
                                imageNumber: index + 1,
                                totalImages: images.length
                            });
                        });
                        
                        // Adicionar indicação de imagens
                        yPosition = addText(`✓ ${images.length} imagem(ns) anexada(s) - ver páginas seguintes`, 
                            textX, yPosition, textWidth, 8, false, azul);
                    }
                    
                    yPosition += 3; // Espaço entre itens
                });
                
                yPosition += 10; // Espaço entre seções
            });
            
            // Adicionar páginas para as imagens
            if (hasImages) {
                imagePages.forEach((imagePage, index) => {
                    addNewPage();
                    
                    // Cabeçalho da página de imagem
                    doc.setFillColor(...azul);
                    doc.rect(0, 0, pageWidth, 40, 'F');
                    
                    doc.setTextColor(255, 255, 255);
                    doc.setFontSize(16);
                    doc.setFont('helvetica', 'bold');
                    doc.text('IMAGEM DO CHECKLIST', pageWidth / 2, 15, { align: 'center' });
                    
                    doc.setFontSize(12);
                    doc.text('GELA BOCA', pageWidth / 2, 25, { align: 'center' });
                    
                    yPosition = margin + 40;
                    
                    // Informações da imagem
                    doc.setTextColor(...preto);
                    doc.setFont('helvetica', 'normal');
                    
                    yPosition = addText(`Item: ${imagePage.itemText}`, margin, yPosition, pageWidth - 2 * margin, 12, true);
                    yPosition = addText(`Status: ${imagePage.isChecked ? 'CONCLUÍDO' : 'PENDENTE'}`, margin, yPosition, pageWidth - 2 * margin, 10, true);
                    yPosition = addText(`Checklist: ${imagePage.checklistType}`, margin, yPosition, pageWidth - 2 * margin, 10, false);
                    yPosition = addText(`Imagem ${imagePage.imageNumber} de ${imagePage.totalImages}`, margin, yPosition, pageWidth - 2 * margin, 10, false);
                    yPosition += 10;
                    
                    // Adicionar a imagem
                    try {
                        const imgWidth = pageWidth - 2 * margin;
                        const imgHeight = (imgWidth * 0.75); // Proporção 4:3
                        
                        if (yPosition + imgHeight > pageHeight - margin) {
                            addNewPage();
                            yPosition = margin + 40;
                        }
                        
                        doc.addImage(imagePage.imageData, 'JPEG', margin, yPosition, imgWidth, imgHeight);
                        yPosition += imgHeight + 10;
                        
                        // Legenda da imagem
                        yPosition = addText(`Imagem relacionada ao item: "${imagePage.itemText}"`, 
                            margin, yPosition, pageWidth - 2 * margin, 9, false, cinza);
                        
                    } catch (e) {
                        console.error('Erro ao adicionar imagem:', e);
                        yPosition = addText('(Erro ao carregar imagem)', margin, yPosition, pageWidth - 2 * margin, 8, false, magenta);
                    }
                });
            }
            
            // Adicionar página de resumo final
            addNewPage();
            
            // Título da página de resumo
            yPosition = addText('RESUMO DO CHECKLIST', pageWidth / 2, yPosition, pageWidth - 2 * margin, 16, true, magenta);
            yPosition += 15;
            
            // Estatísticas
            const totalItems = document.querySelectorAll('#checklistContent input[type="checkbox"]').length;
            const checkedItems = document.querySelectorAll('#checklistContent input[type="checkbox"]:checked').length;
            const percentage = Math.round((checkedItems / totalItems) * 100);
            
            yPosition = addText(`Progresso: ${percentage}% (${checkedItems}/${totalItems} itens)`, 
                margin, yPosition, pageWidth - 2 * margin, 12, true);
            yPosition += 10;
            
            yPosition = addText(`Total de imagens anexadas: ${imagePages.length}`, 
                margin, yPosition, pageWidth - 2 * margin, 10, false);
            yPosition += 5;
            
            yPosition = addText(`Checklist finalizado em: ${new Date().toLocaleString('pt-BR')}`, 
                margin, yPosition, pageWidth - 2 * margin, 10, false);
            
            // Assinatura
            yPosition = pageHeight - 40;
            doc.setDrawColor(...cinza);
            doc.setLineWidth(0.5);
            doc.line(margin, yPosition, pageWidth - margin, yPosition);
            yPosition += 10;
            
            addText(`Responsável: ${loggedUser}`, margin, yPosition, pageWidth - 2 * margin, 10, true);
            
            // Salvar o PDF
            doc.save(`checklist_${loggedUser}_${selectedChecklist}_${date}.pdf`);
        }
    </script>
</body>
</html>